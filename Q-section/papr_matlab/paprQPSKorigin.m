clc;
clear;

%ccdf = comm.CCDF('AveragePowerOutputPort',true,'PeakPowerOutputPort',true);
block=20000;
Q = 4;


for i = 1: block
    message = randi([0 1],512,1);
    message = nrPolarEncode(message,1024,10,false);
    qamTxSig = qammod(message,4,'InputType','bit','UnitAveragePower',true);
    TTT = ifft(qamTxSig(1:16));
    B(i) = 10*log10(max(abs(TTT).^2)/mean(abs(TTT).^2));
    
end

for j = 1:29
   C(j) = length(B(B>2.75+0.25*j)) ;
end

D = [3:0.25:10];
plot(D,log10(C/block));

%[0.992650000000000,0.982400000000000,0.951550000000000,0.917350000000000,
%0.846200000000000,0.793750000000000,0.740900000000000,0.675950000000000,
%0.562200000000000,0.455150000000000,0.398450000000000,0.314650000000000,
%0.261700000000000,0.209800000000000,0.154750000000000,0.111850000000000,
%0.0786500000000000,0.0563500000000000,0.0415500000000000,0.0260000000000000,
%0.0172000000000000,0.00930000000000000,0.00725000000000000,0.00410000000000000,
%%0.00280000000000000,0.00155000000000000,0.000600000000000000,0.000250000000000000
%,0.000250000000000000]